!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("TypoReporter",[],t):"object"==typeof exports?exports.TypoReporter=t():e.TypoReporter=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";function o(e,t,n){if("string"!=typeof e)throw new Error("tagName must be a string");var o=document.createElement(e);return t&&"object"===("undefined"==typeof t?"undefined":r(t))&&Object.keys(t).forEach(function(e){/on[A-Z][a-z]/.test(e)?o[e.toLowerCase()]=t[e]:o.setAttribute(e,t[e])}),"string"==typeof n?o.innerHTML=n:n instanceof Array&&n.forEach(function(e){o.appendChild(e)}),o}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=o,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(e=e||{},!t)throw new Error('"rootNode" is not passed');if(!e.snippetFieldName)throw new Error('"snippetFieldName" option is not defined');if(!e.commentFieldName)throw new Error('"commentFieldName" option is not defined');if(!e.urlFieldName)throw new Error('"urlFieldName" option is not defined');if(!e.formId)throw new Error('"formId" option is not defined');if(e.endpointUrl=e.endpointUrl||"https://cors-anywhere.herokuapp.com/https://docs.google.com/forms/d/e/"+e.formId+"/formResponse?embedded=true",e.offset=e.offset||50,e.translations=e.translations||this.translations,e.locale=e.locale||"en",!e.translations[e.locale])throw new Error("No translations defined for locale "+e.locale);this.i18n=e.translations[e.locale],this.props=e,this.node=t,this.state={},this.submit=this.submit.bind(this),this.handleCommentChange=this.handleCommentChange.bind(this),this.closeDialog=this.closeDialog.bind(this),document.addEventListener("keydown",function(e){e.ctrlKey&&13===e.which&&this.showDialog(),27===e.which&&this.closeDialog()}.bind(this)),this.refresh()}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=o(i);r.prototype.translations={en:{header:"Report a mistake on the page",messageLabel:"There is a mistake in the following text:",commentLabel:"<strong>Do you want to send a notice to a webmaster?</strong>",send:"<strong>Send</strong>",sending:"Sending",cancel:"Cancel",error:"Error! Something went wrong..."},ru:{header:"Сообщите об ошибке на странице",messageLabel:"Ошибка содержится в следующем тексте:",commentLabel:"<strong>Отправить сообщение об ошибке редактору сайта?</strong>",send:"<strong>Отправить</strong>",sending:"Отправляю",cancel:"Отмена",error:"Ошибка! Что-то пошло не так..."}},r.prototype.render=function(){var e=this.state,t=this.i18n;return e.isOpen&&(0,s.default)("div",{class:"ReportTypo"},[(0,s.default)("div",{class:"ReportTypo-header"},t.header),(0,s.default)("div",{class:"ReportTypo-label"},t.messageLabel),(0,s.default)("div",{class:"ReportTypo-message"},e.snippet.replace(">>>",'<u class="ReportTypo-heighlight">').replace("<<<","</u>")),(0,s.default)("textarea",{class:"ReportTypo-comment",onKeyup:this.handleCommentChange},e.comment),(0,s.default)("div",{class:"ReportTypo-label"},t.commentLabel),(0,s.default)("div",{style:"text-align: right;"},[(0,s.default)("button",{type:"button",class:"ReportTypo-submit",onClick:this.submit},e.isSending?t.sending:t.send),(0,s.default)("button",{type:"button",class:"ReportTypo-cancel",onClick:this.closeDialog},t.cancel)]),(0,s.default)("div",null,e.isError&&t.error)])},r.prototype.refresh=function(){var e=this.node;e.innerHTML="";var t=this.render();t&&e.appendChild(t)},r.prototype.submit=function(){var e=this.state,t=this.props;e.isSending=!0,this.refresh();var n=new FormData;n.append(t.snippetFieldName,e.snippet),n.append(t.commentFieldName,e.comment),n.append(t.urlFieldName,window.location);var o=new XMLHttpRequest;o.open("POST",t.endpointUrl,!0),o.onload=function(){o.status>=200&&o.status<400?this.closeDialog():(e.isError=!0,e.isSending=!1,this.refresh())}.bind(this),o.onerror=function(){e.isError=!0,e.isSending=!1,this.refresh()}.bind(this),o.send(n)},r.prototype.getSnippet=function(){var e=this.props,t=document.getSelection(),n=t.toString();if(n){var o=t.getRangeAt(0),r=document.createRange(),i=document.createRange();r.setStartBefore(o.startContainer.ownerDocument.body),r.setEnd(o.startContainer,o.startOffset),i.setStart(o.endContainer,o.endOffset),i.setEndAfter(o.endContainer.ownerDocument.body);var s=r.toString().substr(-e.offset),a=i.toString().substr(0,e.offset),l=s+">>>"+n+"<<<"+a,d=document.createElement("div");return d.innerHTML=l,d.innerText.replace(/\r?\n|\r/g,"").replace(/\s+/g," ")}},r.prototype.showDialog=function(){var e=this.state;e.snippet=this.getSnippet(),e.snippet&&(e.isOpen=!0,this.refresh())},r.prototype.closeDialog=function(){this.state={},this.refresh()},r.prototype.handleCommentChange=function(e){this.state.comment=e.target.value},t.default=r,e.exports=t.default}])});